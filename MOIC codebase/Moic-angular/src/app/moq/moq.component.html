<div class="content-wrapper moq-wrapper">
  <p-dialog header="Notification" [(visible)]="hideMessage" [modal]="true" appendTo="body">
    {{ responseMessage }}
    <p-footer>
      <button type="button" pButton class="btn okay-btn" label="Ok" (click)="hideMessage = false"></button>
    </p-footer>
  </p-dialog>

  <div class="mb-30 moq-top-panel">
    <select name="fashionseason" id="fashionseason" [(ngModel)]="season" (change)="callMoqDataApi()">
      <option *ngFor="let season of getSeasonList" [value]="season"> {{season}} </option>
    </select>
    <select name="channel" id="channel" [(ngModel)]="channel" (change)="callMoqDataApi()">
      <option *ngFor="let channel of getChannelList" [value]="channel"> {{channel}} </option>
    </select>

    <!--<a href='{{hrefUrl}}downloadMOQReport?season={{season}}&channel={{channel}}' target="_blank" class="btn moq-dl-report-btn">Download MOQ Report</a>-->

    <div class="download-seperator">
      <div (mouseleave)="showDropDown = false">
          <button class="drop-toggle btn-flat" (click)="showDropDown=!showDropDown">
              <span *ngIf="checkedList.length<=0">{{getSeasonArray && getSeasonArray[0]?.name}}</span>
              <span *ngIf="checkedList.length>0">{{checkedList.join(', ')}}</span>
              <img src="assets/images/down-arrow.png" />
          </button>
          <div class="drop-show" *ngIf="showDropDown">
              <label *ngFor="let msv of getSeasonArray">
                  <input type="checkbox" [(ngModel)]="msv.checked" (change)="getSelectedValue(msv.checked,msv.name)" />
              <span>{{msv.name}}</span>
              </label>
          </div>
      </div>
  </div>

  <a *ngIf="checkedList.length<=0" href='{{hrefUrl}}downloadMOQReport?season={{getSeasonArray && getSeasonArray[0]?.name}}&channel={{channel}}' target="_blank" class="btn moq-dl-report-btn">Download MOQ Report</a>
  <a *ngIf="checkedList.length>0" href='{{hrefUrl}}downloadMOQReport?season={{checkedList.join(",")}}&channel={{channel}}' target="_blank" class="btn moq-dl-report-btn" (click)="resetSelected(false)">Download MOQ Report</a>

  </div>

  <div class="result-table moq-result-table">
    <p-table [value]="valueWithKeys">
      <ng-template pTemplate="body" let-key>
        <tr>
          <td *ngFor="let col of getMoqUpperTable[key]">
            {{col}}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <hr class="seperator mt-30 mb-30" />
  <div class="info-bar">
      <b>Instructions for Upload MOQ List:</b>
      File name should be <span>MOQ List</span>, extension could be <span>.xls</span> or <span>.xlsx</span>, workbook name should be <span>MOQ List</span>
      <br/>
      <b>Columns in the file should be:</b>
      Season, SKU, Delete, Effective Date
  </div>

  <div class="mb-30 moq-sku-panel">
    <input class="search-sku" placeholder="Search SKU" type="text" [(ngModel)]="sku" (ngModelChange)="this.dt.filter($event, 'sku', 'contains');">
    <a href='{{hrefUrl}}downloadMOQList?season={{season}}' class="btn moq-dl-list-btn" target="_blank">Download MOQ List</a>
    <input style="display: none;" type="file" (change)="uploadMoqListData($event.target.files)" #moqList />
    <button class="btn moq-ul-list-btn" (click)="moqList.value = null; moqList.click()">Upload MOQ List</button>
  </div>
  <div class="result-table moq-sku-result-table">
    <p-table [value]="getMoqTableData" dataKey="idAuto" editMode="row" #dt>
      <ng-template pTemplate="header">
        <tr>
          <th *ngFor="let headertitle of displayedColumnsHeading; let i=index">
            {{headertitle}}
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-moqData let-editing="editing" let-ri="rowIndex">
        <tr [pEditableRow]="moqData">
          <td>
            {{moqData.seasonCode}}
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input pInputText type="text" [(ngModel)]="moqData.sku">
              </ng-template>
              <ng-template pTemplate="output">
                {{moqData.sku}}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <select name="delete" id="delete" [(ngModel)]="moqData.delete">
                  <option *ngFor="let delete of deleteList" [value]="delete"> {{delete}} </option>
                </select>
              </ng-template>
              <ng-template pTemplate="output">
                {{moqData.delete}}
              </ng-template>
            </p-cellEditor>
          </td>
          <td style="text-align:center">
            <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow (click)="onRowEditInit(moqData)" class="row-btn row-edit-icon">
              <img src="assets/images/pencil-icon.jpg" />
            </button>
            <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow (click)="onRowEditSave(moqData, ri)" class="row-btn row-save-icon">
              <img src="assets/images/save-icon.jpg" />
            </button>
            <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow (click)="onRowEditCancel(moqData, ri)" class="row-btn row-cancel-icon">
              <img src="assets/images/cancel-icon.jpg" />
            </button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <hr class="seperator mt-30 mb-30" />
  <div class="info-bar">
      <b>Instructions for Upload Pre Buy List:</b>
      File name should be <span>Pre Buy List</span>, extension could be <span>.xls</span> or <span>.xlsx</span>, workbook name should be <span>Pre Buy List</span>
      <br/>
      <b>Columns in the file should be:</b>
      Season, SKU, IsPreBuySKU, COO
  </div>

  <div class="moq-bottom-panel">
    <a href='{{hrefUrl}}downloadPreBuyList' class="btn dl-pre-buy-list-btn" target="_blank">Download Pre Buy List</a>
    <input style="display: none;" type="file" (change)="uploadPreBuyData($event.target.files)" #preBuy />
    <button class="btn ul-pre-buy-list-btn" (click)="preBuy.value = null; preBuy.click()">Upload Pre Buy List</button>
  </div>
</div>